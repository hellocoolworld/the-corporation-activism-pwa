<ht-header></ht-header>

<ion-content>
  <div
    class="home-splash logged-out"
    [ngClass]="{
      'logged-in': currentUser,
      'logged-out': !currentUser
    }"
  >
    <img *ngIf="currentUser" [src]="currentUser.imageUrl" [alt]="currentUser.displayName" class="main-user-avatar" />
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ng-container *ngIf="currentUser; then titleLoggedIn; else titleLoggedOut"></ng-container>
          <ng-template #titleLoggedIn>You are part of our crowd</ng-template>
          <ng-template #titleLoggedOut>Be part of our crowd</ng-template>
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ng-container *ngIf="currentUser; then contentLoggedIn; else contentLoggedOut"></ng-container>
        <ng-template #contentLoggedIn>
          <div class="user-action-summary">
            <h4>{{ currentUser.displayName }}</h4>
            <div class="action-wrapper">
              <ion-item class="testimonials">
                <ion-icon slot="start" name="quote"></ion-icon>
                <ion-label>
                  <ng-container
                    *ngIf="currentUser.testimonial != ''; then yesTestimonials; else noTestimonial"
                  ></ng-container>
                  <ng-template #yesTestimonials>
                    <a [routerLink]="['/profile', currentUser.id]">
                      Testimonial
                      <br />
                      given
                    </a>
                  </ng-template>
                  <ng-template #noTestimonial>
                    <a href="/user/profile">
                      Add
                      <br />
                      testimonial
                    </a>
                  </ng-template>
                </ion-label>
              </ion-item>
              <ion-item class="pledges">
                <ion-icon slot="start" name="trophy"></ion-icon>
                <ion-label>
                  {{ pledgesCount() }} Action
                  <br />
                  pledges
                </ion-label>
              </ion-item>
              <ion-item class="stories">
                <ion-icon slot="start" name="videocam"></ion-icon>
                <ion-label>
                  <ng-container *ngIf="storiesCount() > 0; then yesStories; else noStories"></ng-container>
                  <ng-template #yesStories>{{ storiesCount() }} Stories</ng-template>
                  <ng-template #noStories>
                    <a href="">
                      Add
                      <br />
                      story
                    </a>
                  </ng-template>
                </ion-label>
              </ion-item>
            </div>
          </div>
        </ng-template>
        <ng-template #contentLoggedOut>
          <p>
            Join supporters of The Corporation films to take a stand against corporate power.
          </p>
          <ion-button (click)="signUp()" expand="block" color="secondary">
            Join our crowd
          </ion-button>
        </ng-template>
      </ion-card-content>
    </ion-card>
  </div>

  <div class="stories-section-intro">
    <h2>Watch Stories. Get Inspired.</h2>
    <p>Watch stories and take action by people who were transformed by the film. Add your own story!</p>
  </div>

  
  <div class="story-wrapper" *ngFor="let s of stories">
    <a href="story/{{ s.slug }}">
      <div class="story-header">
        <ion-img [src]="s.image"></ion-img>
        <h3 class="story-title">{{ s.title }}</h3>
      </div>
    </a>

    <div class="story-action-summary">
      <div class="pledges">
        <ion-item class="header">
          <ion-button slot="start" fill="clear" (click)="showHelpActionPledgeModal()">
            Action Pledges
            <ion-icon name="help-circle" slot="end"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item class="content">
          <ion-icon name="trophy" size="large"></ion-icon>
          <ion-label>{{ s.pledgesCount }}</ion-label>
        </ion-item>
      </div>
      <div class="avocadometer">
        <ion-item class="header">
          <ion-button slot="start" fill="clear" (click)="showHelpAvocadometerModal()">
            Avocadometer
            <ion-icon name="help-circle" slot="end"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item class="content">
          <ion-icon src="/assets/images/avocado-pair.svg" size="large"></ion-icon>
          <ion-label>{{ s.avocados }}</ion-label>
        </ion-item>
      </div>
    </div>

    <ion-item class="summary" lines="none">
      <ion-label text-wrap>{{ s.summary }}</ion-label>
    </ion-item>

    <ion-item class="story-meta" lines="none">
      <ion-avatar slot="start">
        <img [src]="s.authorImg" />
      </ion-avatar>
      <ion-label>
        <div class="authoring-info">{{ s.authorName }} &bull; {{ s.updatedAt }}</div>
        <!-- <div class="story-in-numbers">
          <div class="likes">
            <ion-icon name="heart"></ion-icon>
            {{ s.likes }}
          </div>
          <div class="views">
            <ion-icon name="eye"></ion-icon>
            {{ s.views }}
          </div>
          <div class="comments">
            <ion-icon name="text"></ion-icon>
            {{ s.comments }}
          </div>
        </div> -->
      </ion-label>
    </ion-item>
  </div>

  <ht-footer-ad></ht-footer-ad>
</ion-content>
