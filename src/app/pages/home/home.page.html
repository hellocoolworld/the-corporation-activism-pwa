<ht-header></ht-header>

<ion-content>
  <div class="home-splash" [class.logged-in]="currentUser" [class.logged-out]="!currentUser">
    <div class="user-avatars-wrapper">
      <div class="user-avatars">
        <div *ngFor="let mostRecentAction of mostRecentActions; let i = index" class="user-avatar-wrapper avatar{{ i + 1 }}">
          <ion-item (click)="
          onAvatarClick(
            $event,
            mostRecentAction.userId,
            mostRecentAction.displayName,
            mostRecentAction.relatedTaleTitle,
            mostRecentAction.relatedTaleSlug,
            mostRecentAction.relatedTestamonial
          )
        " lines="none"><img [src]="mostRecentAction.imageUrl" class="user-avatar" [alt]="mostRecentAction.displayName" />
          </ion-item>
          <ion-button (click)="
              onAvatarClick(
                $event,
                mostRecentAction.userId,
                mostRecentAction.displayName,
                mostRecentAction.relatedTaleTitle,
                mostRecentAction.relatedTaleSlug,
                mostRecentAction.relatedTestamonial
              )
            " fill="clear">
            <ion-icon slot="icon-only" [name]="mostRecentAction.actionIcon"></ion-icon>
          </ion-button>
        </div>
      </div>

      <div class="main-user-avatar" *ngIf="currentUser">
        <a [routerLink]="['/profile', currentUser.id]">
          <img [src]="currentUser.imageUrl" [alt]="currentUser.displayName" />
        </a>
      </div>
    </div>
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          {{currentUser ? "You're part of our story" : "Be part of our story" }}
          <span *ngIf="!currentUser"><br>Let's make History</span>
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ng-container *ngIf="currentUser; then contentLoggedIn; else contentLoggedOut"></ng-container>
        <ng-template #contentLoggedIn>
          <div class="user-action-summary">
            <h4>{{ currentUser.displayName }}</h4>
            <div class="action-wrapper">
              <ion-item class="testimonials">
                <ion-icon slot="start" name="quote"></ion-icon>
                <ion-label>
                  <ng-container *ngIf="currentUser.testimonial != ''; then yesTestimonials; else noTestimonial"></ng-container>
                  <ng-template #yesTestimonials>
                    <a [routerLink]="['/profile', currentUser.id]">
                      Testimonial
                      <br />
                      given
                    </a>
                  </ng-template>
                  <ng-template #noTestimonial>
                    <a href="/user/profile">
                      Add
                      <br />
                      testimonial
                    </a>
                  </ng-template>
                </ion-label>
              </ion-item>
              <ion-item class="pledges">
                <ion-icon slot="start" name="trophy"></ion-icon>
                <ion-label>
                  {{ pledgesCount }} Action
                  <br /> pledges
                </ion-label>
              </ion-item>
              <ion-item class="tales">
                <ion-icon slot="start" name="videocam"></ion-icon>
                <ion-label>
                  <ng-container *ngIf="talesCount > 0; then yesTales; else noTales"></ng-container>
                  <ng-template #yesTales>{{ talesCount }} Stories</ng-template>
                  <ng-template #noTales>
                    <a href="">
                      Add
                      <br />
                      story
                    </a>
                  </ng-template>
                </ion-label>
              </ion-item>
            </div>
          </div>
        </ng-template>
        <ng-template #contentLoggedOut>
          <p>
            Join supporters of The Corporation films to take a stand against corporate power.
          </p>
          <ion-button (click)="signUp()" expand="block" class="content-btn">
            Join us
          </ion-button>
        </ng-template>
      </ion-card-content>
    </ion-card>
  </div>

  <div class="tales-section-intro">
    <h2>Watch Stories. Get Inspired.</h2>
    <p>Watch tales and take action by people who were transformed by the film.</p>
  </div>

  <div class="tale-wrapper" *ngFor="let tale of tales">
    <a href="tale/{{ tale.slug }}">
      <div class="tale-header">
        <ion-img [src]="tale.image"></ion-img>
        <h3 class="tale-title">{{ tale.title }}</h3>
      </div>
    </a>

    <div class="tale-action-summary">
      <div class="pledges">
        <ion-item class="header">
          <ion-button slot="start" fill="clear" (click)="showHelpActionPledgeModal()">
            Action Pledges
            <ion-icon name="help-circle" slot="end"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item class="content">
          <ion-icon name="trophy" size="large"></ion-icon>
          <ion-label>{{ tale.pledgeCount }}</ion-label>
        </ion-item>
      </div>
      <div class="avocadometer">
        <ion-item class="header">
          <ion-button slot="start" fill="clear" (click)="showHelpAvocadometerModal()">
            Avocadometer
            <ion-icon name="help-circle" slot="end"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item class="content">
          <ion-icon src="/assets/images/avocadometer.svg" size="large"></ion-icon>
          <ion-label>{{ tale.avocados }}</ion-label>
        </ion-item>
      </div>
    </div>

    <ion-item class="summary" lines="none">
      <ion-label text-wrap>{{ tale.summary }}</ion-label>
    </ion-item>

    <ion-item class="tale-meta" lines="none">
      <ion-avatar slot="start">
        <img [src]="tale.authorImg" />
      </ion-avatar>
      <ion-label>
        <div class="authoring-info">{{ tale.authorName }} &bull; {{ tale.updatedAt }}</div>
      </ion-label>
    </ion-item>
  </div>

  <ht-footer-ad></ht-footer-ad>
</ion-content>